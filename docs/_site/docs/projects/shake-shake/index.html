<!doctype html>

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Shake, Shake - IoT Developer Kits</title>




<meta name="description" content="Use the motion sensor to detect shaking, and use a simple Azure Functions app to find a random tweet with a #hashtag.">




<meta name="author" content="MXChip IoT DevKit">

<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="IoT Developer Kits">
<meta property="og:title" content="Shake, Shake">


  <link rel="canonical" href="https://microsoft.github.io/azure-iot-developer-kit/docs/projects/shake-shake/">
  <meta property="og:url" content="https://microsoft.github.io/azure-iot-developer-kit/docs/projects/shake-shake/">



  <meta property="og:description" content="Use the motion sensor to detect shaking, and use a simple Azure Functions app to find a random tweet with a #hashtag.">





  

  



  <meta property="og:image" content="https://microsoft.github.io/azure-iot-developer-kit/assets/images/projects-shake-shake.jpg">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2017-07-16T22:29:51-07:00">






  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://microsoft.github.io/azure-iot-developer-kit",
      "logo": "https://microsoft.github.io/azure-iot-developer-kit/assets/images/site-logo.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "MXChip IoT DevKit",
      "url" : "https://microsoft.github.io/azure-iot-developer-kit",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="https://microsoft.github.io/azure-iot-developer-kit/feed.xml" type="application/atom+xml" rel="alternate" title="IoT Developer Kits Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="https://microsoft.github.io/azure-iot-developer-kit/assets/css/main.css">
<link rel="stylesheet" href="https://microsoft.github.io/azure-iot-developer-kit/assets/css/extended/extended_main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="https://microsoft.github.io/azure-iot-developer-kit/">IoT Developer Kits</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="https://microsoft.github.io/azure-iot-developer-kit/docs/get-started/">Docs</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://microsoft.github.io/azure-iot-developer-kit/docs/projects/">Projects</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://microsoft.github.io/azure-iot-developer-kit/versions/">Versions</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://blogs.msdn.microsoft.com/iotdev/">Blog</a></li>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    
  





<div class="page__hero"
  style="  "
>
  
    <img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/projects-shake-shake.jpg" alt="Shake, Shake" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Shake, Shake">
    <meta itemprop="description" content="Use the motion sensor to detect shaking, and use a simple Azure Functions app to find a random tweet with a #hashtag.">
    <meta itemprop="datePublished" content="July 16, 2017">
    <meta itemprop="dateModified" content="May 05, 2017">

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Shake, Shake
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p>In this project, you will learn how to use the motion sensor to trigger an event using Azure Functions. The app will retrieve a random tweet with a #hashtag you have configured in your Arduino sketch. The tweet will display on the DevKit screen.</p>

<aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-columns"></i> On This Page</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#what-you-need" id="markdown-toc-what-you-need">What you need</a></li>
  <li><a href="#windows" id="markdown-toc-windows">Windows</a>    <ul>
      <li><a href="#step-1-open-project-folder" id="markdown-toc-step-1-open-project-folder">Step 1. Open project folder</a></li>
      <li><a href="#step-2-provision-azure-services" id="markdown-toc-step-2-provision-azure-services">Step 2. Provision Azure services</a></li>
      <li><a href="#step-3-modify-the-hashtag" id="markdown-toc-step-3-modify-the-hashtag">Step 3. Modify the #hashtag</a></li>
      <li><a href="#step-4-deploy-azure-functions" id="markdown-toc-step-4-deploy-azure-functions">Step 4. Deploy Azure Functions</a></li>
      <li><a href="#step-5-build-and-upload-arduino-sketch" id="markdown-toc-step-5-build-and-upload-arduino-sketch">Step 5. Build and upload Arduino sketch</a></li>
    </ul>
  </li>
  <li><a href="#macos" id="markdown-toc-macos">macOS</a></li>
  <li><a href="#test-the-project" id="markdown-toc-test-the-project">Test the project</a></li>
  <li><a href="#how-it-works" id="markdown-toc-how-it-works">How it works</a></li>
  <li><a href="#optional-use-your-own-twitter-bearer-token" id="markdown-toc-optional-use-your-own-twitter-bearer-token">Optional: Use your own Twitter bearer token</a></li>
  <li><a href="#problems-and-feedback" id="markdown-toc-problems-and-feedback">Problems and feedback</a>    <ul>
      <li><a href="#problems" id="markdown-toc-problems">Problems</a></li>
      <li><a href="#feedback" id="markdown-toc-feedback">Feedback</a></li>
    </ul>
  </li>
</ul>

  </nav>
</aside>

<h2 id="what-you-need">What you need</h2>

<ul>
  <li>Finish the <a href="https://microsoft.github.io/azure-iot-developer-kit/docs/get-started/">Getting Started Guide</a></li>
</ul>

<div class="switcher">
    <li class="switch_tag"> Platform: </li>
    
        <li class="switch_li"><a id="windows_switch" class="switch" href="#windows"> Windows </a></li>
    
        <li class="switch_li"><a id="macos_switch" class="switch" href="#macos"> macOS </a></li>
    
</div>

<h2 id="windows">Windows</h2>

<h3 id="step-1-open-project-folder">Step 1. Open project folder</h3>

<h4 id="a-launch-vs-code">A. Launch VS Code</h4>

<p>Make sure your DevKit is not connected. Launch VS Code first and connect the DevKit to your computer. VS Code will automatically find it and pops up introduction page:</p>

<p><img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-vscode.png" alt="mini-solution-vscode" /></p>

<p class="notice--warning"><strong>Notice:</strong> Occasionally, when you launch VS Code, you will be prompted with error that cannot find Arduino IDE or related board package. To solve it, close VS Code, launch Arduino IDE once and VS Code should locate Arduino IDE path correctly.</p>

<h4 id="b-open-arduino-examples-folder">B. Open Arduino Examples folder</h4>

<p>Switch to <strong>‘Arduino Examples’</strong> tab, navigate to <code class="highlighter-rouge">Examples for MXCHIP AZ3166 &gt; AzureIoT</code> and click on <code class="highlighter-rouge">ShakeShake</code>.</p>

<p><img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-catalog.png" alt="mini-solution-catalog" /></p>

<p>If you closed the <strong>Arduino Examples</strong> pane, to reload it, use <code class="highlighter-rouge">Ctrl+Shift+P</code> to invoke command palette and type <strong>Arduino</strong> then find and select <strong>Arduino: Examples</strong>.</p>

<h3 id="step-2-provision-azure-services">Step 2. Provision Azure services</h3>

<p>In the solution window, run your task through <strong>Quick Open</strong> (<code class="highlighter-rouge">Ctrl+P</code>) by typing ‘task cloud-provision’:</p>

<p>In the VS Code terminal, an interactive command line will guide you through provisioning the required Azure services:</p>

<p><img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-provision-sub.png" alt="mini-solution-provision-sub" /></p>

<h3 id="step-3-modify-the-hashtag">Step 3. Modify the #hashtag</h3>

<p>Open <code class="highlighter-rouge">ShakeShake.ino</code> and look for the line of code:</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">iot_event</span> <span class="o">=</span> <span class="s">"{</span><span class="se">\"</span><span class="s">topic</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">iot</span><span class="se">\"</span><span class="s">}"</span><span class="p">;</span>
</code></pre>
</div>

<p>Replace the string <code class="highlighter-rouge">iot</code> in the curly brace with your preferred hashtag.</p>

<h3 id="step-4-deploy-azure-functions">Step 4. Deploy Azure Functions</h3>

<p>Use <strong>Quick Open</strong> (<code class="highlighter-rouge">Ctrl+P</code>) to run ‘task cloud-deploy’. It will start deploying the Azure Functions code. Normally it takes 2 to 5 minutes to finish:</p>

<p><img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-deploy.png" alt="mini-solution-deploy" /></p>

<h3 id="step-5-build-and-upload-arduino-sketch">Step 5. Build and upload Arduino sketch</h3>

<p>Use <strong>Quick Open</strong> (<code class="highlighter-rouge">Ctrl+P</code>) to run ‘task device-upload’. The terminal will prompt you to enter configuration mode. To do so, hold down button A, then push and release the reset button. The screen will display ‘Configuration’. This is to set the connection string that retrieves from ‘task cloud-provision’ step.</p>

<p>Then it will start verifying and uploading the Arduino sketch:</p>

<p><img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-build.png" alt="mini-solution-build" /></p>

<p>The DevKit will reboot and start running the code.</p>

<p class="notice--warning"><strong>Notice:</strong> If you are running on a clean machine with everything installed, during the verifying of the code phrase, you might get and error of <strong>Unknown board AZ3166</strong>. To work around this problem, open Arduino IDE and go to <strong>Tool &gt; Board manager</strong>. Arduino will reload all json files for all package definitions. After it is done, you can launch VS Code again and try the build process, the problem should go away.</p>

<h2 id="macos">macOS</h2>

<p>We are currently working on interative command line experience for macOS just same as for Windows. These <a href="https://microsoft.github.io/azure-iot-developer-kit/docs/projects/shake-shake-macos/">manual steps</a> will use portal to provision Azure services.</p>

<h2 id="test-the-project">Test the project</h2>

<p>After app initialization, click button A and mildly shake the board to retrieve a random tweet with your hashtag (e.g. #build2017). A tweet will display on your screen in a few seconds:</p>

<figure class="third ">
  
    
      <a href="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-shake-shake-1.jpg">
        <img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-shake-shake-1.jpg" alt="Arduino application initializing" />
      </a>
    
  
    
      <a href="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-shake-shake-2.jpg">
        <img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-shake-shake-2.jpg" alt="Ready to shake" />
      </a>
    
  
    
      <a href="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-shake-shake-3.jpg">
        <img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-shake-shake-3.jpg" alt="Display a random tweet" />
      </a>
    
  
  
    <figcaption>Shake, shake for a random tweet with #hashtag you set in the code.
</figcaption>
  
</figure>

<ul>
  <li>Press button A again, then shake for a new tweet.</li>
  <li>Press button B to scroll through the rest of the tweet.</li>
</ul>

<p class="notice--info"><strong>Note:</strong> Sometimes you will see ‘On processing…’ status on screen without getting the results. You can try to click <code class="highlighter-rouge">Reset</code> button to restart the app.</p>

<h2 id="how-it-works">How it works</h2>

<p><img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/mini-solution-diagram-shake-shake.png" alt="mini-solution-voice-to-tweet-diagram" /></p>

<p>The Arduino sketch sends an event to Azure IoT Hub which triggers the Azure Functions app. Azure Functions contains the logic to connect to Twitter’s API and retrieve a tweet. It wraps the tweet text into a C2D (Cloud-to-device) message and sends it back to the device.</p>

<h2 id="optional-use-your-own-twitter-bearer-token">Optional: Use your own Twitter bearer token</h2>

<p>This sample project uses an pre-configured Twitter bearer token for testing purpose. But there is a <a href="https://dev.twitter.com/rest/reference/get/search/tweets" target="_blank">rate limits</a> for every Twitter account. You might want to consider using your own token. Here is simple instructions to do so:</p>

<ol>
  <li>
    <p>Go to <a href="https://dev.twitter.com/" target="_blank">Twitter Developer portal</a> to register a new Twitter app.</p>
  </li>
  <li>
    <p><a href="https://support.yapsody.com/hc/en-us/articles/203068116-How-do-I-get-a-Twitter-Consumer-Key-and-Consumer-Secret-key-" target="_blank">Get Consumer Key and Consumer Secrets</a> of your app.</p>
  </li>
  <li>
    <p>Use <a href="https://gearside.com/nebula/utilities/twitter-bearer-token-generator/" target="_blank">some utlity</a> to generate Twitter bearer token from these two keys.</p>
  </li>
  <li>
    <p>In the <a href="https://portal.azure.com/" target="_blank">Azure portal</a>, get into the <strong>Resource Group</strong> and find the Azure Function (Type: App Service) for your “Shake, Shake” project. The name always contains ‘shake…’ string.
  <img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/shake-shake-function.png" alt="shake-shake-function" /></p>
  </li>
  <li>Update the code for <code class="highlighter-rouge">index.js</code> within <strong>Functions &gt; myFunc</strong> with your own token:
    <div class="language-javascript highlighter-rouge"><pre class="highlight"><code>  <span class="p">...</span>
  <span class="nl">headers</span><span class="p">:</span> <span class="p">{</span>
 <span class="s1">'Authorization'</span><span class="err">:</span> <span class="s1">'Bearer '</span> <span class="o">+</span> <span class="s1">'[your own token]'</span>
  <span class="p">}</span>
  <span class="p">...</span>
</code></pre>
    </div>
    <p><img src="https://microsoft.github.io/azure-iot-developer-kit/assets/images/shake-shake-own-twitter-token.png" alt="shake-shake-own-twitter-token" /></p>
  </li>
  <li>Save the file and click <strong>Run</strong>.</li>
</ol>

<h2 id="problems-and-feedback">Problems and feedback</h2>

<h3 id="problems">Problems</h3>

<h4 id="the-screen-displays-no-tweets-while-every-step-has-run-successfully">The screen displays ‘No Tweets’ while every step has run successfully</h4>

<p>It normally happens for the first time you deploy and run the sample. This is because that Azure Function will requires a couple of seconds up to one minute to code start the app. Or there are some blips when running the code that will cause restarting of the app. Then the device app can get time out for fetching the tweet. In this case, you may try to click restart button to run the device app again.</p>

<h3 id="feedback">Feedback</h3>

<p>You can find <a href="https://microsoft.github.io/azure-iot-developer-kit/docs/faq/">FAQs</a> if you encounter other problems or reach out to us from the channels below.</p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-05-05">May 05, 2017</time></p>
        
      </footer>

      <section class="page__share">
    <p>Reach us at</p>
  <a href="http://gitter.im/Microsoft/azure-iot-developer-kit">
    <img src="https://badges.gitter.im/iot-devkit.svg" alt="Join Gitter chat" style="height:25px">
  </a>

  <p>or share on</p>
  
  <a href="https://twitter.com/intent/tweet?text=Shake, Shake https://microsoft.github.io/azure-iot-developer-kit/docs/projects/shake-shake/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://microsoft.github.io/azure-iot-developer-kit/docs/projects/shake-shake/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://microsoft.github.io/azure-iot-developer-kit/docs/projects/shake-shake/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
          <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/Microsoft/azure-iot-developer-kit"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://microsoft.github.io/azure-iot-developer-kit/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">Copyright &copy; 2017 Microsoft Corp.</div>
      </footer>
    </div>

    <script src="https://microsoft.github.io/azure-iot-developer-kit/assets/js/main.min.js"></script>
<script src="https://microsoft.github.io/azure-iot-developer-kit/assets/js/extended/extended_main.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98097460-1', 'auto');
  ga('send', 'pageview');
</script>







  </body>
</html>

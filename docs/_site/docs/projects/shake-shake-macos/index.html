<!doctype html>

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->









<title>Shake, shake - IoT Developer Kits</title>




<meta name="description" content="Rapidly develop an IoT app using Microsoft Azure and Visual Studio Code">




<meta name="author" content="MXChip IoT Developer Kit">

<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="IoT Developer Kits">
<meta property="og:title" content="Shake, shake">


  <link rel="canonical" href="http://localhost:4000/azure-iot-developer-kit/docs/projects/shake-shake-macos/">
  <meta property="og:url" content="http://localhost:4000/azure-iot-developer-kit/docs/projects/shake-shake-macos/">







  

  



  <meta property="og:image" content="http://localhost:4000/azure-iot-developer-kit/assets/images/site-logo.png">








  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000/azure-iot-developer-kit",
      "logo": "http://localhost:4000/azure-iot-developer-kit/assets/images/site-logo.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "MXChip IoT Developer Kit",
      "url" : "http://localhost:4000/azure-iot-developer-kit",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/azure-iot-developer-kit/feed.xml" type="application/atom+xml" rel="alternate" title="IoT Developer Kits Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/azure-iot-developer-kit/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="http://localhost:4000/azure-iot-developer-kit/">IoT Developer Kits</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/azure-iot-developer-kit/docs/get-started/">Docs</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/azure-iot-developer-kit/docs/projects/">Projects</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/azure-iot-developer-kit/versions/">Versions</a></li>
          
            
            <li class="masthead__menu-item"><a href="https://blogs.msdn.microsoft.com/iotdev/">Blog</a></li>
          
        </ul>
        <button><div class="navicon"></div></button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    



<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Shake, shake">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Shake, shake
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        <p class="notice--warning"><strong>Note:</strong> This manual steps for running <strong>‘Shake, shake’</strong> project on macOS is subject to change.</p>

<aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-columns"></i> On This Page</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#step-1-create-azure-iot-hub" id="markdown-toc-step-1-create-azure-iot-hub">Step 1. Create Azure IoT Hub</a></li>
  <li><a href="#step-2-register-a-device-in-the-iot-hub-for-the-your-device" id="markdown-toc-step-2-register-a-device-in-the-iot-hub-for-the-your-device">Step 2. Register a device in the IoT hub for the your device</a></li>
  <li><a href="#step-3-configure-device-connection-string-to-devkit" id="markdown-toc-step-3-configure-device-connection-string-to-devkit">Step 3. Configure device connection string to DevKit</a></li>
  <li><a href="#step-4-deploy-azure-functions" id="markdown-toc-step-4-deploy-azure-functions">Step 4. Deploy Azure Functions</a></li>
  <li><a href="#step-5-build-and-upload-arduino-sketch" id="markdown-toc-step-5-build-and-upload-arduino-sketch">Step 5. Build and upload Arduino sketch</a></li>
  <li><a href="#test-the-project" id="markdown-toc-test-the-project">Test the project</a></li>
</ul>

  </nav>
</aside>

<h3 id="step-1-create-azure-iot-hub">Step 1. Create Azure IoT Hub</h3>

<ol>
  <li>
    <p>Sign in to <a href="https://portal.azure.com/">Azure portal</a>.</p>
  </li>
  <li>
    <p>Click <strong>New &gt; Internet of Things &gt; IoT Hub</strong> or search for ‘IoT Hub’ and click <strong>Create</strong>:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-create-iothub.png" alt="shake-shake-mac-create-iothub" /></p>
  </li>
  <li>In the <strong>IoT hub</strong> pane, enter the following information for your IoT hub:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-hub-details.png" alt="shake-shake-mac-hub-details" />
    <blockquote>
      <ul>
        <li><strong>Name</strong>: It is the name for your IoT hub. If the name you enter is valid, a green check mark appears.</li>
        <li><strong>Pricing and scale tier</strong>: Select the free F1 tier. This option is sufficient for this demo. See <a href="https://azure.microsoft.com/pricing/details/iot-hub/" target="_blank">pricing and scale tier</a>.</li>
        <li><strong>Resource group</strong>: Create a resource group to host the IoT hub or use an existing one. See Using <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-portal" target="_blank">resource groups to manage your Azure resources</a>.</li>
        <li><strong>Location</strong>: Select the closest location to you where the IoT hub is created.</li>
        <li><strong>Pin the dashboard</strong>: Check this option for easy access to your IoT hub from the dashboard.</li>
      </ul>
    </blockquote>
  </li>
  <li>
    <p>Click <strong>Create</strong>. It could take a few minutes for your IoT hub to be created. You can see progress in the <strong>Notifications</strong> pane:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-notification.png" alt="shake-shake-mac-notification" /></p>
  </li>
  <li>
    <p>After your IoT hub is created, click it from the Resource groups. Make a note of the IoT Hub name:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-iothub-name.png" alt="shake-shake-mac-iothub-name" /></p>
  </li>
  <li>Click on the IoT Hub name, in the <strong>Shared access policies</strong> pane, click the <strong>iothubowner</strong> policy, and then make a note of the <strong>Connection string</strong> value for your IoT hub:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-iothub-connection-string.png" alt="shake-shake-mac-iothub-connection-string" /></li>
</ol>

<h3 id="step-2-register-a-device-in-the-iot-hub-for-the-your-device">Step 2. Register a device in the IoT hub for the your device</h3>

<ol>
  <li>
    <p>In the <a href="https://portal.azure.com/" target="_blank">Azure portal</a>, open your IoT hub.</p>
  </li>
  <li>
    <p>Click <strong>Device Explorer</strong>.</p>
  </li>
  <li>In the Device Explorer pane, click <strong>Add</strong> to add a device with name “<strong>AZ3166</strong>” to your IoT hub:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-create-device.png" alt="shake-shake-mac-create-device" />
    <blockquote>
      <ul>
        <li><strong>Device ID</strong>: The ID of the new device.</li>
        <li><strong>Authentication type</strong>: Select Symmetric Key.</li>
        <li><strong>Auto generate keys</strong>: Check this field.</li>
        <li><strong>Connect device to IoT Hub</strong>: Click Enable.</li>
      </ul>
    </blockquote>
  </li>
  <li>
    <p>Click <strong>Save</strong>.</p>
  </li>
  <li>
    <p>After the device is created, open the device in the <strong>Device Explorer</strong> pane.</p>
  </li>
  <li>Make a note of the primary key of the connection string.
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-connection-string.png" alt="shake-shake-mac-connection-string" /></li>
</ol>

<h3 id="step-3-configure-device-connection-string-to-devkit">Step 3. Configure device connection string to DevKit</h3>

<ol>
  <li>
    <p>With your DevKit connected to computer, open the terminal.</p>
  </li>
  <li>List relevant serial port:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> ls -l /dev/cu.<span class="k">*</span>
</code></pre>
    </div>
    <p>You get following outputs like:</p>
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> crw-rw-rw-  1 root  wheel   20,   1 May 17 18:36 /dev/cu.Bluetooth-Incoming-Port
 crw-rw-rw-  1 root  wheel   20,  33 May 18 18:11 /dev/cu.usbmodem1423
</code></pre>
    </div>
    <p>The later one ended with <code class="highlighter-rouge">usbmodem1423</code> is the actual serial port of the DevKit.</p>
  </li>
  <li>Open serial monitor:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> screen /dev/cu.usbmodem1423 115200
</code></pre>
    </div>
  </li>
  <li>
    <p>Get into configuration mode:
 Hold down button A, then push and release the reset button.</p>
  </li>
  <li>In the prompt of the serial port with <code class="highlighter-rouge">#</code>, configure your connection string you get from previous step:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> set_az_iothub <span class="o">[</span>your connection string]
</code></pre>
    </div>
    <p>You will see the information once configuration is successful:</p>
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> INFO: Set Azure Iot hub connection string successfully.
</code></pre>
    </div>
    <p>Now exit the serial monitor by first type <code class="highlighter-rouge">Ctrl+A</code> and then <code class="highlighter-rouge">Ctrl+\</code> and type ‘y’.</p>
  </li>
</ol>

<h3 id="step-4-deploy-azure-functions">Step 4. Deploy Azure Functions</h3>

<h4 id="a-create-azure-functions">A. Create Azure Functions</h4>

<ol>
  <li>
    <p>Click <strong>New &gt; Everything</strong> and search for <strong>Function App</strong>:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-create-function-app.png" alt="shake-shake-mac-create-function-app" /></p>
  </li>
  <li>
    <p>Specify the Name and Resource Group of the function:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-function-app-name.png" alt="shake-shake-mac-function-app-name" /></p>
  </li>
  <li>
    <p>Go to the Function App you just created and create a new custom function:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-custom-function.png" alt="shake-shake-mac-custom-function" /></p>
  </li>
  <li>
    <p>Choose <strong>EventHubTrigger-Javascript</strong> from the template list and type the IoT Hub name you noted in <strong>Event Hub name</strong> field:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-eventhub-trigger.png" alt="shake-shake-mac-eventhub-trigger" /></p>
  </li>
  <li>
    <p>Click <strong>New</strong> to create Event Hub connection:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-new-eventhub-connection.png" alt="shake-shake-mac-new-eventhub-connection" /></p>
  </li>
  <li>
    <p>Select <strong>IoT Hub</strong> tab, confirm it selects the right IoT Hub and click <strong>Select</strong>:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-function-connection-string.png" alt="shake-shake-mac-function-connection-string" /></p>
  </li>
  <li>
    <p>Click <strong>Create</strong> to finish creating a new function.</p>
  </li>
</ol>

<h4 id="b-upload-the-azure-functions-files-of-the-project">B. Upload the Azure Functions files of the project</h4>

<ol>
  <li>
    <p>Click <strong>[my function name] &gt; View Files &gt; Upload</strong>:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-function-upload.png" alt="shake-shake-mac-function-upload" /></p>
  </li>
  <li>
    <p>Press <code class="highlighter-rouge">Cmd+Shift+G</code>, and then click <strong>Go</strong>.</p>
  </li>
  <li>Continue to navigate to the following folder:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> ~/Library/Arduino15/packages/AZ3166/hardware/stm32f4/0.8.1/libraries/AzureIotHub/examples/ShakeShake/azureFunction
</code></pre>
    </div>
  </li>
  <li>
    <p>Upload <code class="highlighter-rouge">index.js</code> and <code class="highlighter-rouge">package.json</code>.</p>
  </li>
  <li>
    <p>Click <code class="highlighter-rouge">index.js</code> again to refresh the code:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-function-refresh.png" alt="shake-shake-mac-function-refresh" /></p>
  </li>
  <li>
    <p>Select <strong>Platform features</strong> and click <strong>Console</strong> to launch the console:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-open-console.png" alt="shake-shake-mac-open-console" /></p>
  </li>
  <li>In the console, run the following commands:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code> <span class="nb">cd</span> <span class="o">[</span>your <span class="k">function </span>name]
 npm install
</code></pre>
    </div>
    <p><img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-npm-install.png" alt="shake-shake-mac-npm-install" /></p>
  </li>
</ol>

<h4 id="c-configure-and-run-azure-functions">C. Configure and run Azure Functions</h4>

<ol>
  <li>
    <p>Select <strong>Platform features</strong> and click <strong>Application settings</strong>:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-app-settings.png" alt="shake-shake-mac-app-settings" /></p>
  </li>
  <li>Add a new Key / Value pair in <strong>App settings</strong> section and click <strong>Save</strong>:
    <ul>
      <li>Key: <strong>iotHubConnectionString</strong></li>
      <li>Value: <strong>[your IoT Hub connection string]</strong>
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-eventhub-connection-string.png" alt="shake-shake-mac-eventhub-connection-string" /></li>
    </ul>
  </li>
  <li>Go to your Azure Function code and click <strong>Run</strong>:
 <img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-mac-function-run.png" alt="shake-shake-mac-function-run" /></li>
</ol>

<h3 id="step-5-build-and-upload-arduino-sketch">Step 5. Build and upload Arduino sketch</h3>

<h4 id="a-open-arduino-examples-folder-in-vs-code">A. Open Arduino Examples folder in VS Code:</h4>

<p>Make sure your DevKit is not connected. Launch VS Code first and connect the DevKit to your computer. VS Code will automatically find it and pops up introduction page. Switch to <strong>‘Arduino Examples’</strong> tab, navigate to <code class="highlighter-rouge">Examples for MXCHIP AZ3166 &gt; AzureIoTHub</code> and click on <code class="highlighter-rouge">ShakeShake</code>.</p>

<p><img src="http://localhost:4000/azure-iot-developer-kit/assets/images/shake-shake-example.png" alt="shake-shake-example" /></p>

<p class="notice--warning"><strong>Notice:</strong> Occasionally, when you launch VS Code, you will be prompted with error that cannot find Arduino IDE or related board package. To solve it, close VS Code, launch Arduino IDE once and VS Code should locate Arduino IDE path correctly.</p>

<h4 id="b-modify-the-hashtag">B. Modify the #hashtag</h4>

<p>Open <code class="highlighter-rouge">ShakeShake.ino</code> and look for the line of code:</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">iot_event</span> <span class="o">=</span> <span class="s">"{</span><span class="se">\"</span><span class="s">topic</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">iot</span><span class="se">\"</span><span class="s">}"</span><span class="p">;</span>
</code></pre>
</div>

<p>Replace the string <code class="highlighter-rouge">iot</code> in the curly brace with your preferred hashtag.</p>

<h4 id="c-build-and-upload-arduino-sketch">C. Build and upload Arduino sketch</h4>

<p>Use <code class="highlighter-rouge">Cmd+Shift+P</code> to invoke command palette and type <strong>Arduino</strong> then find and select <strong>Arduino: Upload</strong>. Then it will start compiling and uploading the Arduino sketch. After it is done, the DevKit will reboot and start running the code.</p>

<h2 id="test-the-project">Test the project</h2>

<p>Check how to <a href="http://localhost:4000/azure-iot-developer-kit/docs/projects/shake-shake/#test-the-project">test the result</a>.</p>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
          <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/Microsoft/azure-iot-developer-kit"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/azure-iot-developer-kit/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">Copyright &copy; 2017 Microsoft Corp.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/azure-iot-developer-kit/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98097460-1', 'auto');
  ga('send', 'pageview');
</script>







  </body>
</html>
